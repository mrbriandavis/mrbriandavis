<!doctype html>
<html>

<head>
    <title>Yammer Action Buttons</title>
    <meta property="og:url" content="" />
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
    <script data-app-id="kW8GTCFsG64mmk1HYUtA" src="https://assets.staging.yammer.com/assets/platform_js_sdk.js"></script>
    <script type="text/javascript" src="https://assets.staging.yammer.com/assets/platform_embed.js"></script>
</head>

<body>
    <script>

        function logout() {
            yam.getLoginStatus(
                function (response) {
                    if (response.authResponse) {
                        yam.logout(function (response) {
                            toggleLoginStatus(false);
                            location.reload();
                        })
                    }
                }
            );
        }


        function toggleLoginStatus(loggedIn) {
            if (loggedIn) {
                $('.not-logged-in').hide();
                $('.logged-in').show('slow');
            } else {
                $('.not-logged-in').show('slow');
                $('.logged-in').hide();
            }
        }

        function displayAuthResult(authResult) {
            console.log("AuthResult", authResult); //print user information to the console

            $('#yammer-login').innerHTML = 'Welcome to Yammer!';
            toggleLoginStatus(true);

            $('#authResult').html('Auth Result:<br/>');
            for (var field in authResult) {
                $('#authResult').append(' ' + field + ': ' +
                    authResult[field] + '<br/>');
            }
            $('#authOps').show('slow');

        }

        function getCurrentUser() {
            yam.platform.request({
                // yam.request({
                url: "users/current.json", //this is one of many REST endpoints that are available
                method: "GET",
                data: {},
                success: function (user) { //print message response information to the console
                    console.log("User request was successful.");
                    console.dir(user);
                    toggleLoginStatus(true);
                    $('#authResult').html('User Result:<br/>');
                    for (var field in user) {
                        $('#authResult').append(' ' + field + ': ' +
                            escape(user[field]) + '<br/>');
                    }

                },
                error: function (user) {
                    console.error("There was an error with the request.");
                }
            });

        }

        function login() {
            console.log("Trigger LoginStatus");
            yam.getLoginStatus(
                function (response) {
                    if (response.authResponse) {
                        console.log("Logged in");
                        displayAuthResult(response.access_token);
                    } else {
                        console.log("Not logged in.  Going to login now.");
                        yam.login(function (response) { //prompt user to login and authorize your app, as necessary
                            if (response.authResponse) {
                                displayAuthResult(response.access_token);
                                localStorage.setItem(1, JSON.stringify(response.access_token.token).replace(/"/g, ""));
                            }
                        });
                    }
                }
            );

        }

        function logout() {
            yam.getLoginStatus(
                function (response) {
                    if (response.authResponse) {
                        yam.logout(function (response) {
                            console.log("User was logged out");
                            location.reload();
                        })
                    } else {
                        toggleLoginStatus(false);
                    }
                }
            );
        }

        $(document).ready(function () {

            //toggleLoginStatus(false);

            if (typeof console.log !== 'function') {
                //fake it for sucky browser
                console.log = function () {};
                console.error = function () {};
            }

            $('#yammer-js-login-button').click(login);
            $('#yammer-user-button').click(getCurrentUser);


            /** Event Listeners */
            yam.on('all', function (eventname, msg) {
                console.log("========>>> yam.all =>", eventname, (new Date).getTime());
            });

            yam.on('error', function (e) {
                console.error("======>>> yam.error =>", e);
            });
        });

        yam.connect.embedFeed({
            container: '#embedded-feed',
            feedType: 'open-graph',
            feedId: '',
            config: {
                use_sso: false,
                header: true,
                footer: true,
                showOpenGraphPreview: false

            },
            objectProperties: {
                url: '',
                type: 'page'
            }
        });

        yam.connect.actionButton({
            container: "#embedded-follow",
            action: "follow"
        });

        yam.connect.actionButton({
            container: "#embedded-like",
            action: "like"
        });
    </script>
    <div>
        <button id="yammer-js-login-button">JS Login</button>
        <button id="yammer-user-button">Get Current User</button>
        <div id="embedded-follow"></div>
        <div id="embedded-like"></div>
        <div id="embedded-feed" style="height:400px;width:500px;"></div>

    </div>
</body>

</html>
