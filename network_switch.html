<script type="text/javascript" data-app-id="Jj6bfqCVm5aZl7KcvMOmIQ" src="https://assets.staging.yammer.com/assets/platform_js_sdk.js"></script>
<script>
yam.getLoginStatus(function(response) {
  if (response.authResponse)
	{
		//GET THE TOKENS FOR ALL MY NETWORKS
	   	yam.platform.request({
			url: "oauth/tokens.json",
			method: "GET",
			success: function(msg) {
				var access_token = "";
				for (var i=0; i < msg.length; i++) {
					//GRAB THE TOKEN FOR THE DESIRED NETWORK
					if (msg[i].network_permalink == "testnetwork12344")
					{
						console.log(msg[i].network_permalink)
						access_token = msg[i].token;
						break;
					}
				};

        //request messages for the target network
        yam.platform.request({
					url: "messages.json",
					method: "GET",
					beforeSend: function (req) {   //send the access_token in the HTTP header
						req.headers.Authorization = "Bearer " + access_token;
					},
					success: function(msg) {
						console.log(msg);
					},
					error: function(msg) {
						console.log(msg);
					}
				});

			},
			error: function(msg) {
				console.log(msg);
			}
		});
	}
    else
    {
		yam.platform.login(function (response) {
     //prompt user to login and authorize your app, as necessary
        if (response.authResponse) {
            displayAuthResult(response.access_token);
            localStorage.setItem(1, JSON.stringify(response.access_token.token).replace(/"/g, ""));
        }
    });
	}
});
</script>
